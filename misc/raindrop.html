<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
      #chart {
        position: fixed;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        z-index: -2;
        height: 100%;
      }
      body {
        font-family: sans-serif
      }
      .line {
        stroke-width: 1px;
        opacity: 1;
        pointer-events: none;
        fill: none;
      }
    </style>
  </head>
  <body>
    <div id="chart">
    </div>
    <script>
      var chartDiv = document.getElementById("chart");
      var width = chartDiv.clientWidth -10;
      var height = chartDiv.clientHeight -20;
      var index;

      var xScale = d3.scaleLinear().range([0,width]).domain([0,1000])
      var yScale = d3.scaleLinear().range([0,height]).domain([0,1000])
      var x = d3.scaleLinear().range([0,width]).domain([-20,20])
      var y = d3.scaleLinear().range([height,0]).domain([9,-3])
      var scale = d3.scaleLinear().range([0,height]).domain([0,1000])

      var line = d3.line()
        .curve(d3.curveBasis)
        .x(function(d,i){
          var correctedX;
          if(i < 3) {
            correctedX = i
          }
          else if (i < 9){
            correctedX = 6-i
          }
          else {
            correctedX = i-12
          }
          console.log('x:' + correctedX)
          return x(correctedX )
        })
        .y(function(d,i){
          if(i > 3 && i < 10){
            var multiplier = -1
            var x = 6-i
          }
          else if (i > 9){
            var multiplier = 1
            var x = i - 12
          }
          else{
            var multiplier = 1
            var x = i
          }
          //console.log(x)
          var radius = 3
          console.log('y: '+multiplier * (Math.sqrt(Math.pow(radius,2) - Math.pow(x,2))))
          //return y(d) - y(100 * multiplier * (Math.sqrt(Math.pow(radius,2) - Math.pow(x,2))-radius));
          return y(multiplier * (Math.sqrt(Math.pow(radius,2) - Math.pow(x,2)))-radius);
         })

      var svg = d3.select('body').append('svg')
        .attr("width", width)
        .attr("height", height)

      d3.tsv('rainData.txt', function(error,data){
        if (error) throw error;

        for (var i = 0; i < data.length; i++){
          data[i].y = Object.values(data[i]).slice(1)
        }

        var rings = svg.selectAll('.rings')
          .data(data)
          .enter()
          .append('g')
            .attr('class','rings')
            .attr('transform','translate(' + xScale(0) + ',' + yScale(500)+ ')')

        rings.append('path')
          .attr('class','line')
          .attr('d',function(d,i){index = i; return line(d.y)})
          .attr('stroke','black')
      })
    </script>
  </body>
</html>
