<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
        #chart {
            position: fixed;
            left: 0px;
            right: 0px;
            top: 0px;
            bottom: 0px;
            z-index: -2;
            height: 100%;
        }
        body {
            font-family: sans-serif
        }
        div.tooltip {
            position: absolute;
            text-align: left;
            width: 120px;
            height: 50px;
            padding-left: 10px;
            font: 12px sans-serif;
            border: 0.5px solid gray;
            background: white;
            border-radius: 5px;
            pointer-events: none;
            padding-top: 10px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
    </style>
  </head>
  <body>
    <div id="chart">
    </div>
    <script>
        var chartDiv = document.getElementById("chart");
        var margin = 20
        var width = chartDiv.clientWidth;
        var height = chartDiv.clientHeight;
        var xshift = 70

        var signatures = ['Signature.1','Signature.2','Signature.3','Signature.4','Signature.5','Signature.6','Signature.7','Signature.8','Signature.9','Signature.10','Signature.11','Signature.12','Signature.13','Signature.14','Signature.15','Signature.16','Signature.17','Signature.18','Signature.19','Signature.20','Signature.21','Signature.22','Signature.23','Signature.24','Signature.25','Signature.26','Signature.27','Signature.28','Signature.29','Signature.30',]
        var signatureColors = ['#93003a', '#9e203a', '#a9333a', '#b4443b', '#bf533d', '#c9623f', '#d37144', '#dc804a', '#e58f52', '#ed9f5c', '#f4ae69', '#fbbd79', '#ffce8d', '#ffdfa5', '#ffefc1', '#b3f3bf', '#a9edcd', '#a5e5d7', '#a5dedd', '#a7d6e1', '#aacee3', '#afc5e5', '#b4bce6', '#bab3e6', '#bfa9e5', '#c59fe4', '#cb95e3', '#d18ae1', '#d67edf', '#dc71dc']
        
        var signaturesShortlist = ['Signature.1','Signature.3','Signature.4','Signature.5','Signature.8','Signature.9','Signature.12','Signature.15','Signature.16','Signature.18','Signature.19','Signature.20','Signature.22','Signature.23','Signature.29']
        var shortlistColors = ['#66C5CC','#F6CF71','#F89C74','#DCB0F2','#87C55F','#9EB9F3','#FE88B1','#C9DB74','#8BE0A4','#B497E7','#D3B484','#B3B3B3','#7F3C8D','#11A579','#3969AC']//['#DF84A5','#CC8CB8','#B195C5','#919ECB','#6FA6C9','#4FACBF','#3BB0AE','#3FB298','#54B180','#6EAF69','#88AB55','#A2A547','#BB9D42','#D09448','#E18A56']
        
        var sortedSamples = ['PM1024-Z1-1-Case-WGS','PM2086-Z1-Case-WGS','PM1207-Z1-1-Case-WGS','PM1358-Z1-1-Case-WGS','PM191-Z8-1-Case-WGS','PM493-Z1-1-Case-WGS','PM12_Z13_1_Case','PM12_Z4_2_Case','PM223-Z4-1-WGS','PM428-Z2-1-Case-WGS','','PM1388-Z3-1-Case-WGS','PM1207-Z4-1-Case-WGS','PM90-Z25-1-Case-WGS','PM1358A-Z3-1-Case-WGS','PM1358A-Z2-1-Case-WGS','PM90-Z21-1-Case','PM1358A-Z4-1-Case-WGS','PM89-Z1-1-Case','PM1232-Z16-1-Case-WGS','PM1232-Z4-1-Case-WGS','PM0_Tissue_LM2_A','PM677-Z9-1-Case-WGS','PM677-Z7-1-Case-WGS','PM677-Z12-1-Case-WGS','PM677-Z16-1-Case-WGS','PM63-Z6-1-Case-WGS','PM63-Z3-1-Case-WGS','PM59-Z2-1-Case','PM0_Tissue_LM1_A','PM7_Tissue','PM1_Tissue','PM90-Z19-1-Case-WGS','PM159-Z22-1-Case','PM159-Z1-1-Case-WGS','PM159-Z6-1-Case-WGS','PM159-Z7-1-Case-WGS',' ','PM4_Tissue_LLB_LLA_LT2_LA_MED','PM63-Z2-1-Case','PM63-Z10-1-Case-WGS','PM12-Z10-1-Case-WGS','PM223-Z2-1-Case-WGS','PM159-Z13-1-Case-WGS']
        
        //,#F2B701,#E73F74,#80BA5A,#E68310,#008695,#CF1C90,#f97b72,#4b4b8f,#A5AA99
        var x = d3.scaleBand().range([xshift,width-250])
        var y = d3.scaleLinear().range([height-215,0]).domain([0,1.05])
        var scale = d3.scaleLinear().range([0,height]).domain([0,1000])
        var colorScale = d3.scaleOrdinal().range(shortlistColors).domain(signaturesShortlist)

        var svg = d3.select("body").append("svg")
            .attr("width", chartDiv.clientWidth - margin)
            .attr("height", chartDiv.clientHeight - margin)
            .attr('transform','translate(' + margin/4 + ',' + margin/4 + ')')

        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        
        var yaxis = d3.axisLeft()
            .scale(y)
        
        var xaxis = d3.axisBottom()
            .scale(x)
        
        for(i in signaturesShortlist){
            
            svg.append('rect')
                .attr('x', width-230)
                .attr('y', scale(i*20))
                .attr('fill', function(d){
                    return colorScale(signaturesShortlist[i])
                })
                .attr('height',10)
                .attr('width',10)
            
            svg.append('text')
                .attr('x', width-210)
                .attr('y', scale(i*20))
                .text(signaturesShortlist[i])
                .attr('fill','black')
                .attr('dy',scale(12))
                .style('font-size',scale(15))
        }
        
        
        
        //start drawing actual data
        d3.tsv('deconstructSigs.all.final.txt', function(error,data){
            if (error) throw error;
            
            var layers = d3.stack().keys(signatures)(data)
            
            /*
            x.domain(layers[0].map(function(d){
                //console.log(d.data.Sample)
                return d.data.Sample
            }))*/
            x.domain(sortedSamples)
            
            var layer = svg.selectAll('layer')
                .data(layers)
                .enter()
                .append('g')
                .attr('class', function(d){
                    return d.key
                })
                .style('fill',function(d){
                    return colorScale(d.key)
                })
            
            layer.selectAll('rect')
                .data(function(d){
                    return d
                })
                .enter()
                .append('rect')
                .attr('x', function(d){
                    return x(d.data.Sample)
                })
                .attr('y', function(d){
                    return y(d[1])
                })
                .attr('height', function(d){
                    return y(d[0]) - y(d[1])
                })
                .attr('width', x.bandwidth()-1)
            
            svg.append('g')
                .attr('class','yaxis')
                .attr('transform',`translate(${xshift-5},0)`)
                .call(yaxis)
            
            svg.append('g')
                .attr('class','xaxis')
                .attr('transform',`translate(0,${height-210})`)
                .call(xaxis)
                .selectAll('text')
                    .style('text-anchor','end')
                    .attr('dy', -6)
                    .attr('dx', -10)
                    .attr('transform', function(d){
                        return "rotate(-90)"
                    })
        })

    </script>
  </body>
</html>
