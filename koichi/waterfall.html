<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
      #chart {
        position: fixed;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        z-index: -2;
        height: 100%;
      }
      body {
        font-family: sans-serif
      }
    </style>
  </head>
  <body>
    <div id="chart">
    </div>
    <script>
      var chartDiv = document.getElementById("chart");
      var width = chartDiv.clientWidth -20;
      var height = chartDiv.clientHeight -100;

      var x = d3.scaleLinear().range([0,height*1.5]).domain([0,1000])
      var y = d3.scaleLinear().range([0,height-100]).domain([5,-2])
      var scale = d3.scaleLinear().range([0,height]).domain([0,1000])
      var margin = {top: 20, right: 20, bottom: 70, left: 40}

      var testscale = d3.scaleLinear().range([0,height-100]).domain([0,7])

      var yAxis = d3.axisLeft()


      var mut_scale = d3.scaleOrdinal()
        .domain([0,7])
        .range(['#9ecae1','#fcbba1','#fc9272','#fb6a4a','#ef3b2c','#cb181d','#99000d'])

      var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

      d3.tsv("data/MTX.txt", function(error,data){
        if (error) throw error;
        console.log(data)

        var columnWidth = 40
        var columnSpacing = 5

        var bars = svg.selectAll('rect')
          .data(data)
          .enter()
          .append('g')
          .attr('transform',function(d,i){return "translate(" + (i * scale(columnWidth + columnSpacing) + 5) + ")"})

        var columns = bars.append('rect')
          .attr('fill',function(d){
            return mut_scale(d.n_mutations)
          })
          .attr('height', function(d){return testscale(Math.abs(d.lfc))})
          .attr('width',scale(columnWidth))
          .attr('y', function(d){
            if(Math.sign(d.lfc) == 1){
              return y(0) - testscale(d.lfc);
            } else {
              return y(0);
            }
          })

        bars.append('text')
          .text(function(d){console.log(d);return d.gene_name})
          .attr('fill','white')
          .attr('text-anchor',function(d){
            if(Math.sign(d.lfc) == 1){
              return "end"
            }
            else {
              return "start"
            }
          })
          .attr('transform','rotate(-90)')
          .attr('dy',scale(columnWidth/2 + 5))
          .attr('x', function(d){
              return -1 * y(d.lfc)
          })
          .attr('dx',function(d){
            if(Math.sign(d.lfc) == 1){
              return scale(5) * -1
            }
            else {
              return scale(5)
            }
          })

          svg.append("g")
           .attr("class", "y")
           .call(d3.axisLeft(y))
      })
    </script>
  </body>
</html>
